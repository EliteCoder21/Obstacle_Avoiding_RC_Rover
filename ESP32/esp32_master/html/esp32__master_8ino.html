<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: esp32_master.ino File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('esp32__master_8ino.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">esp32_master.ino File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Master ESP32-S3 node for an obstacle-avoiding RC rover.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;Wire.h&gt;</code><br />
<code>#include &lt;semphr.h&gt;</code><br />
<code>#include &lt;WiFi.h&gt;</code><br />
<code>#include &lt;esp_now.h&gt;</code><br />
<code>#include &lt;NewPing.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8eab89acd7dcb0e77e7b00d1749022a6" id="r_a8eab89acd7dcb0e77e7b00d1749022a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8eab89acd7dcb0e77e7b00d1749022a6">TRIG_PIN</a>&#160;&#160;&#160;5</td></tr>
<tr class="memitem:acea96cea4a13b6cb38e57a86788adf90" id="r_acea96cea4a13b6cb38e57a86788adf90"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acea96cea4a13b6cb38e57a86788adf90">ECHO_PIN</a>&#160;&#160;&#160;18</td></tr>
<tr class="memitem:aa90ee2a5d317c250c522b347d4f40e2c" id="r_aa90ee2a5d317c250c522b347d4f40e2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa90ee2a5d317c250c522b347d4f40e2c">ALARM_PIN</a>&#160;&#160;&#160;4</td></tr>
<tr class="memitem:a10d46323ddfdb95d982a416eb4ca9f54" id="r_a10d46323ddfdb95d982a416eb4ca9f54"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a10d46323ddfdb95d982a416eb4ca9f54">CRITICAL_THRESHOLD</a>&#160;&#160;&#160;8</td></tr>
<tr class="memitem:a829eb2998fdc3017684473e503582c10" id="r_a829eb2998fdc3017684473e503582c10"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a829eb2998fdc3017684473e503582c10">OBSTACLE_THRESHOLD</a>&#160;&#160;&#160;20</td></tr>
<tr class="memitem:a08e4da5f3d0c7936fa52467f40e4b6aa" id="r_a08e4da5f3d0c7936fa52467f40e4b6aa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a08e4da5f3d0c7936fa52467f40e4b6aa">MAX_DISTANCE</a>&#160;&#160;&#160;100</td></tr>
<tr class="memitem:aea0d8480f835303c2d54e9b5bb2c0cf1" id="r_aea0d8480f835303c2d54e9b5bb2c0cf1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aea0d8480f835303c2d54e9b5bb2c0cf1">TURN_TIME</a>&#160;&#160;&#160;100</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-enum-members" class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a1b85feff254cf2dd1106c34423b58988" id="r_a1b85feff254cf2dd1106c34423b58988"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b85feff254cf2dd1106c34423b58988">CarCommand</a> : uint8_t { <br />
&#160;&#160;<a class="el" href="#a1b85feff254cf2dd1106c34423b58988a1e0ceff2d6f13742786f42dac58149bc">CMD_STOP</a> = 0
, <a class="el" href="#a1b85feff254cf2dd1106c34423b58988ad7c5bedebb4b88326aeba69e5533619c">CMD_FORWARD</a>
, <a class="el" href="#a1b85feff254cf2dd1106c34423b58988a7ac9ce45a50d00c58c95c3dc3611004d">CMD_BACKWARD</a>
, <a class="el" href="#a1b85feff254cf2dd1106c34423b58988a6209b9b123c01914b557bb921f334f88">CMD_LEFT</a>
, <br />
&#160;&#160;<a class="el" href="#a1b85feff254cf2dd1106c34423b58988a9f69104487ae00ae3f63308c4cd7ce58">CMD_RIGHT</a>
<br />
 }</td></tr>
<tr class="memdesc:a1b85feff254cf2dd1106c34423b58988"><td class="mdescLeft">&#160;</td><td class="mdescRight">High-level motion commands for the rover.  <a href="#a1b85feff254cf2dd1106c34423b58988">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab898071398b359603a35c202e9c65f3b" id="r_ab898071398b359603a35c202e9c65f3b"><td class="memItemLeft" align="right" valign="top">struct&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab898071398b359603a35c202e9c65f3b">__attribute__</a> ((packed))</td></tr>
<tr class="memitem:a4e7a1e753b409db867e65d13ec392ebe" id="r_a4e7a1e753b409db867e65d13ec392ebe"><td class="memItemLeft" align="right" valign="top">HardwareSerial&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e7a1e753b409db867e65d13ec392ebe">SerialMega</a> (2)</td></tr>
<tr class="memitem:a23ef27d9d4851fee1c394c6f9c9978df" id="r_a23ef27d9d4851fee1c394c6f9c9978df"><td class="memItemLeft" align="right" valign="top">NewPing&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a23ef27d9d4851fee1c394c6f9c9978df">sonar</a> (<a class="el" href="#a8eab89acd7dcb0e77e7b00d1749022a6">TRIG_PIN</a>, <a class="el" href="#acea96cea4a13b6cb38e57a86788adf90">ECHO_PIN</a>, <a class="el" href="#a08e4da5f3d0c7936fa52467f40e4b6aa">MAX_DISTANCE</a>)</td></tr>
<tr class="memitem:ace76ac213025eb45827c22aad967f067" id="r_ace76ac213025eb45827c22aad967f067"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ace76ac213025eb45827c22aad967f067">readUltrasonicCM</a> ()</td></tr>
<tr class="memdesc:ace76ac213025eb45827c22aad967f067"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read distance from the ultrasonic sensor in centimeters.  <br /></td></tr>
<tr class="memitem:aed5ed0bd2e2ff80454eaeb9559dfbf60" id="r_aed5ed0bd2e2ff80454eaeb9559dfbf60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed5ed0bd2e2ff80454eaeb9559dfbf60">receiveCommand</a> (const esp_now_recv_info_t *recv_info, const uint8_t *incomingData, int len)</td></tr>
<tr class="memdesc:aed5ed0bd2e2ff80454eaeb9559dfbf60"><td class="mdescLeft">&#160;</td><td class="mdescRight">ESP-NOW receive callback for processing incoming remote commands.  <br /></td></tr>
<tr class="memitem:a5a1b9a34bbab7db83b3a0d76ec214ab9" id="r_a5a1b9a34bbab7db83b3a0d76ec214ab9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5a1b9a34bbab7db83b3a0d76ec214ab9">decisionTask</a> (void *parameter)</td></tr>
<tr class="memdesc:a5a1b9a34bbab7db83b3a0d76ec214ab9"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task that decides safe motion based on distance and remote command.  <br /></td></tr>
<tr class="memitem:a217451a0ec75f826e5a2933c3268c7c2" id="r_a217451a0ec75f826e5a2933c3268c7c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a217451a0ec75f826e5a2933c3268c7c2">sensorTask</a> (void *pvParameters)</td></tr>
<tr class="memdesc:a217451a0ec75f826e5a2933c3268c7c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task that periodically measures distance and updates the shared state.  <br /></td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d" id="r_a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:a4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arduino setup function that initializes hardware, ESP-NOW, and tasks.  <br /></td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f" id="r_afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main Arduino loop left intentionally empty.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a36b39d4c7f34e2433de063c35376826a" id="r_a36b39d4c7f34e2433de063c35376826a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#a1b85feff254cf2dd1106c34423b58988">CarCommand</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36b39d4c7f34e2433de063c35376826a">remoteCommand</a> = <a class="el" href="#a1b85feff254cf2dd1106c34423b58988a1e0ceff2d6f13742786f42dac58149bc">CMD_STOP</a></td></tr>
<tr class="memitem:add5befb9cd6e425f0528bc551e0e7588" id="r_add5befb9cd6e425f0528bc551e0e7588"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#add5befb9cd6e425f0528bc551e0e7588">ControlPacket</a></td></tr>
<tr class="memitem:a7a8c65a5f257c31758761bdc84f1f8f4" id="r_a7a8c65a5f257c31758761bdc84f1f8f4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7a8c65a5f257c31758761bdc84f1f8f4">measuredDistanceCm</a> = 50</td></tr>
<tr class="memitem:a73aa187c19d5448a3dc42d88e81644d8" id="r_a73aa187c19d5448a3dc42d88e81644d8"><td class="memItemLeft" align="right" valign="top">SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73aa187c19d5448a3dc42d88e81644d8">distanceMutex</a> = NULL</td></tr>
<tr class="memitem:a9e93e0f4e23104509fe75ae12179141b" id="r_a9e93e0f4e23104509fe75ae12179141b"><td class="memItemLeft" align="right" valign="top">SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e93e0f4e23104509fe75ae12179141b">commandMutex</a> = NULL</td></tr>
<tr class="memitem:a95a80735083a5a0764fa9dc60cd5b0ae" id="r_a95a80735083a5a0764fa9dc60cd5b0ae"><td class="memItemLeft" align="right" valign="top">TaskHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a95a80735083a5a0764fa9dc60cd5b0ae">sensorTaskHandle</a> = NULL</td></tr>
<tr class="memitem:a2eeb6c5a58f292ff963f305852f9dfc0" id="r_a2eeb6c5a58f292ff963f305852f9dfc0"><td class="memItemLeft" align="right" valign="top">TaskHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2eeb6c5a58f292ff963f305852f9dfc0">decisionTaskHandle</a> = NULL</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Master ESP32-S3 node for an obstacle-avoiding RC rover. </p>
<p>Receives high-level drive commands over ESP-NOW from a remote controller, measures obstacle distance with an ultrasonic sensor, and forwards safe motion commands to an Arduino Mega motor driver over serial. Basic safety logic overrides user commands when obstacles are detected. </p>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="aa90ee2a5d317c250c522b347d4f40e2c" name="aa90ee2a5d317c250c522b347d4f40e2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa90ee2a5d317c250c522b347d4f40e2c">&#9670;&#160;</a></span>ALARM_PIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALARM_PIN&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a10d46323ddfdb95d982a416eb4ca9f54" name="a10d46323ddfdb95d982a416eb4ca9f54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10d46323ddfdb95d982a416eb4ca9f54">&#9670;&#160;</a></span>CRITICAL_THRESHOLD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CRITICAL_THRESHOLD&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acea96cea4a13b6cb38e57a86788adf90" name="acea96cea4a13b6cb38e57a86788adf90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acea96cea4a13b6cb38e57a86788adf90">&#9670;&#160;</a></span>ECHO_PIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ECHO_PIN&#160;&#160;&#160;18</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a08e4da5f3d0c7936fa52467f40e4b6aa" name="a08e4da5f3d0c7936fa52467f40e4b6aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08e4da5f3d0c7936fa52467f40e4b6aa">&#9670;&#160;</a></span>MAX_DISTANCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_DISTANCE&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a829eb2998fdc3017684473e503582c10" name="a829eb2998fdc3017684473e503582c10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a829eb2998fdc3017684473e503582c10">&#9670;&#160;</a></span>OBSTACLE_THRESHOLD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OBSTACLE_THRESHOLD&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8eab89acd7dcb0e77e7b00d1749022a6" name="a8eab89acd7dcb0e77e7b00d1749022a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eab89acd7dcb0e77e7b00d1749022a6">&#9670;&#160;</a></span>TRIG_PIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRIG_PIN&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aea0d8480f835303c2d54e9b5bb2c0cf1" name="aea0d8480f835303c2d54e9b5bb2c0cf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea0d8480f835303c2d54e9b5bb2c0cf1">&#9670;&#160;</a></span>TURN_TIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TURN_TIME&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-enum-members" id="doc-enum-members"></a><h2 id="header-doc-enum-members" class="groupheader">Enumeration Type Documentation</h2>
<a id="a1b85feff254cf2dd1106c34423b58988" name="a1b85feff254cf2dd1106c34423b58988"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b85feff254cf2dd1106c34423b58988">&#9670;&#160;</a></span>CarCommand</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#a1b85feff254cf2dd1106c34423b58988">CarCommand</a> : uint8_t</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>High-level motion commands for the rover. </p>
<p>These commands are received from the remote controller over ESP-NOW and translated into serial strings for the Arduino Mega motor driver. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a1b85feff254cf2dd1106c34423b58988a1e0ceff2d6f13742786f42dac58149bc" name="a1b85feff254cf2dd1106c34423b58988a1e0ceff2d6f13742786f42dac58149bc"></a>CMD_STOP&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1b85feff254cf2dd1106c34423b58988ad7c5bedebb4b88326aeba69e5533619c" name="a1b85feff254cf2dd1106c34423b58988ad7c5bedebb4b88326aeba69e5533619c"></a>CMD_FORWARD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1b85feff254cf2dd1106c34423b58988a7ac9ce45a50d00c58c95c3dc3611004d" name="a1b85feff254cf2dd1106c34423b58988a7ac9ce45a50d00c58c95c3dc3611004d"></a>CMD_BACKWARD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1b85feff254cf2dd1106c34423b58988a6209b9b123c01914b557bb921f334f88" name="a1b85feff254cf2dd1106c34423b58988a6209b9b123c01914b557bb921f334f88"></a>CMD_LEFT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1b85feff254cf2dd1106c34423b58988a9f69104487ae00ae3f63308c4cd7ce58" name="a1b85feff254cf2dd1106c34423b58988a9f69104487ae00ae3f63308c4cd7ce58"></a>CMD_RIGHT&#160;</td><td class="fielddoc"></td></tr>
</table>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ab898071398b359603a35c202e9c65f3b" name="ab898071398b359603a35c202e9c65f3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab898071398b359603a35c202e9c65f3b">&#9670;&#160;</a></span>__attribute__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(packed)</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>&lt; Encoded <a class="el" href="#a1b85feff254cf2dd1106c34423b58988" title="High-level motion commands for the rover.">CarCommand</a> value.</p>

</div>
</div>
<a id="a5a1b9a34bbab7db83b3a0d76ec214ab9" name="a5a1b9a34bbab7db83b3a0d76ec214ab9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a1b9a34bbab7db83b3a0d76ec214ab9">&#9670;&#160;</a></span>decisionTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void decisionTask </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>parameter</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task that decides safe motion based on distance and remote command. </p>
<p>This task periodically reads the latest distance measurement and remote command (both protected by mutexes). When an obstacle is too close, it overrides the user command and backs up; otherwise, it forwards the latest user command to the motor controller.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parameter</td><td>Unused pointer required by the FreeRTOS task signature. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main Arduino loop left intentionally empty. </p>
<p>All logic is handled in FreeRTOS tasks started in <a class="el" href="#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino setup function that initializes hardware, ESP-NOW, and tasks.">setup()</a>. </p>

</div>
</div>
<a id="ace76ac213025eb45827c22aad967f067" name="ace76ac213025eb45827c22aad967f067"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace76ac213025eb45827c22aad967f067">&#9670;&#160;</a></span>readUltrasonicCM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int readUltrasonicCM </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read distance from the ultrasonic sensor in centimeters. </p>
<p>Uses the NewPing library to trigger a measurement. If no echo is detected (raw distance is 0), this is treated as MAX_DISTANCE so that logic can assume a large distance instead of a failed reading.</p>
<dl class="section return"><dt>Returns</dt><dd>Distance to the nearest obstacle in centimeters, with 0 mapped to MAX_DISTANCE. </dd></dl>

</div>
</div>
<a id="aed5ed0bd2e2ff80454eaeb9559dfbf60" name="aed5ed0bd2e2ff80454eaeb9559dfbf60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed5ed0bd2e2ff80454eaeb9559dfbf60">&#9670;&#160;</a></span>receiveCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void receiveCommand </td>
          <td>(</td>
          <td class="paramtype">const esp_now_recv_info_t *</td>          <td class="paramname"><span class="paramname"><em>recv_info</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>incomingData</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ESP-NOW receive callback for processing incoming remote commands. </p>
<p>Validates the packet size, extracts the <a class="el" href="struct_control_packet.html" title="ESP-NOW control packet carrying a single command.">ControlPacket</a> payload, and updates the shared remoteCommand under a mutex. Also prints a human-readable log of the received command over the debug serial port.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">recv_info</td><td>Metadata about the received ESP-NOW packet (unused here). </td></tr>
    <tr><td class="paramname">incomingData</td><td>Pointer to the raw packet data. </td></tr>
    <tr><td class="paramname">len</td><td>Length of the incoming packet in bytes. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a217451a0ec75f826e5a2933c3268c7c2" name="a217451a0ec75f826e5a2933c3268c7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a217451a0ec75f826e5a2933c3268c7c2">&#9670;&#160;</a></span>sensorTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sensorTask </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>pvParameters</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task that periodically measures distance and updates the shared state. </p>
<p>Continuously reads the ultrasonic sensor, writes the latest distance into the shared measuredDistanceCm variable under a mutex, and toggles the alarm output when an obstacle is closer than CRITICAL_THRESHOLD.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pvParameters</td><td>Unused pointer required by the FreeRTOS task signature. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4e7a1e753b409db867e65d13ec392ebe" name="a4e7a1e753b409db867e65d13ec392ebe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e7a1e753b409db867e65d13ec392ebe">&#9670;&#160;</a></span>SerialMega()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HardwareSerial SerialMega </td>
          <td>(</td>
          <td class="paramtype">2</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arduino setup function that initializes hardware, ESP-NOW, and tasks. </p>
<p>Configures serial ports, ultrasonic and alarm pins, creates mutexes, sets up Wi-Fi in station mode, initializes ESP-NOW with a receive callback, and starts the decision and sensor tasks pinned to different cores. </p>

</div>
</div>
<a id="a23ef27d9d4851fee1c394c6f9c9978df" name="a23ef27d9d4851fee1c394c6f9c9978df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23ef27d9d4851fee1c394c6f9c9978df">&#9670;&#160;</a></span>sonar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NewPing sonar </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a8eab89acd7dcb0e77e7b00d1749022a6">TRIG_PIN</a></td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#acea96cea4a13b6cb38e57a86788adf90">ECHO_PIN</a></td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a08e4da5f3d0c7936fa52467f40e4b6aa">MAX_DISTANCE</a></td>          <td class="paramname"><span class="paramname"><em></em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="a9e93e0f4e23104509fe75ae12179141b" name="a9e93e0f4e23104509fe75ae12179141b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e93e0f4e23104509fe75ae12179141b">&#9670;&#160;</a></span>commandMutex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SemaphoreHandle_t commandMutex = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="add5befb9cd6e425f0528bc551e0e7588" name="add5befb9cd6e425f0528bc551e0e7588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add5befb9cd6e425f0528bc551e0e7588">&#9670;&#160;</a></span>ControlPacket</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ControlPacket</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2eeb6c5a58f292ff963f305852f9dfc0" name="a2eeb6c5a58f292ff963f305852f9dfc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eeb6c5a58f292ff963f305852f9dfc0">&#9670;&#160;</a></span>decisionTaskHandle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TaskHandle_t decisionTaskHandle = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a73aa187c19d5448a3dc42d88e81644d8" name="a73aa187c19d5448a3dc42d88e81644d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73aa187c19d5448a3dc42d88e81644d8">&#9670;&#160;</a></span>distanceMutex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SemaphoreHandle_t distanceMutex = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7a8c65a5f257c31758761bdc84f1f8f4" name="a7a8c65a5f257c31758761bdc84f1f8f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a8c65a5f257c31758761bdc84f1f8f4">&#9670;&#160;</a></span>measuredDistanceCm</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int measuredDistanceCm = 50</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a36b39d4c7f34e2433de063c35376826a" name="a36b39d4c7f34e2433de063c35376826a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36b39d4c7f34e2433de063c35376826a">&#9670;&#160;</a></span>remoteCommand</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#a1b85feff254cf2dd1106c34423b58988">CarCommand</a> remoteCommand = <a class="el" href="#a1b85feff254cf2dd1106c34423b58988a1e0ceff2d6f13742786f42dac58149bc">CMD_STOP</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a95a80735083a5a0764fa9dc60cd5b0ae" name="a95a80735083a5a0764fa9dc60cd5b0ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95a80735083a5a0764fa9dc60cd5b0ae">&#9670;&#160;</a></span>sensorTaskHandle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TaskHandle_t sensorTaskHandle = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="esp32__master_8ino.html">esp32_master.ino</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
